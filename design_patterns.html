<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>✍️ Design patterns - Generic Associated Types Initiative</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="index.html">👋 Welcome</a></li><li class="chapter-item "><a href="CHARTER.html">📜 Charter</a></li><li class="chapter-item "><a href="mvp.html">🏗️ MVP Stabilization</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="mvp/concern-too-complex.html">Concern: GATs permit abstractions that make Rust harder to use</a></li><li class="chapter-item "><a href="mvp/concern-too-rough.html">Concern: GATs are too hard to learn, especially in their current state</a></li><li class="chapter-item "><a href="mvp/concern-lifetimes-only.html">Concern: we should stabilize lifetime GATs only</a></li><li class="chapter-item "><a href="mvp/concern-backcompat.html">Concern: not confident the current MVP is backwards compatible</a></li><li class="chapter-item "><a href="mvp/concern-right-rules-for-required-bounds.html">Concern: Do we have the right rules for required bounds?</a></li></ol></li><li class="chapter-item "><a href="explainer.html">📚 Explainer</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="explainer/motivation.html">Why GATs?</a></li><li class="chapter-item "><a href="explainer/iterable.html">Defining and implementing the Iterable trait with GATs</a></li><li class="chapter-item "><a href="explainer/where-clauses.html">GATs in where-clauses</a></li><li class="chapter-item "><a href="explainer/rough_edges.html">Rough edges</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="explainer/required_bounds.html">Required bounds</a></li><li class="chapter-item "><a href="explainer/no_implied_bounds.html">No implied bounds on HRTB</a></li></ol></li></ol></li><li class="chapter-item "><a href="shiny_future.html">🔮 Shiny future</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="shiny_future/iterable.html">Defining and implementing the Iterable trait with GATs</a></li><li class="chapter-item "><a href="shiny_future/where-clauses.html">GATs in where-clauses</a></li><li class="chapter-item "><a href="shiny_future/proposals.html">Proposals</a></li></ol></li><li class="chapter-item expanded "><a href="design_patterns.html" class="active">✍️ Design patterns</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="design_patterns/iterable.html">Iterable and lending iterators</a></li><li class="chapter-item "><a href="design_patterns/many_modes.html">Many modes</a></li><li class="chapter-item "><a href="design_patterns/generic_scopes.html">Generic scopes</a></li><li class="chapter-item "><a href="design_patterns/pointer_types.html">Pointer types</a></li></ol></li><li class="chapter-item "><a href="design-discussions/index.html">💬 Design discussions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="design-discussions/outlives-defaults.html">💬 Outlives defaults</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="design-discussions/outlives-defaults-1.html">Initial write-up</a></li></ol></li><li class="chapter-item "><a href="design-discussions/where-the-where-1.html">💬 Where does the where clause go?</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="design-discussions/where-the-where.html">Initial write-up</a></li></ol></li><li class="chapter-item "><a href="design-discussions/complexity.html">💬 Are GATs too complex?</a></li><li class="chapter-item "><a href="design-discussions/lifetimes-only.html">💬 Should GATs only support lifetime parameters?</a></li></ol></li><li class="chapter-item "><a href="FAQ.html">😕 FAQ</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Generic Associated Types Initiative</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/generic-associated-types-initiative" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="design-patterns"><a class="header" href="#design-patterns">Design patterns</a></h1>
<p>A natural question with GATs is to ask &quot;what are they used for?&quot; Because GATs represent a kind of &quot;fundamental capability&quot; of traits, though, that question can be difficult to answer in a short summary -- they can be used for all kinds of things! Therefore, this section attempts to answer by summarizing &quot;design patterns&quot; that we have seen in the wild that are enabled by GATs. These patterns are described through a &quot;deep dive&quot; into a particular example, often of a crate in the wild; but they represent patterns that could be extracted and applied in other cases.</p>
<h2 id="list-of-projects-using-gats"><a class="header" href="#list-of-projects-using-gats">List of projects using GATs</a></h2>
<p>Over the years, many people have posted examples of how they would like to use GATs. compiler-errors compiled a mostly complete list which was <a href="https://github.com/rust-lang/rust/pull/96709#issuecomment-1173170243">posted to the stabilization issue</a>. We reproduce that list here:</p>
<h3 id="projects-using-gats"><a class="header" href="#projects-using-gats">Projects using GATs</a></h3>
<ul>
<li><a href="https://github.com/sfu-db/connector-x"><code>connector-x</code></a> - uses GATs to provide zero-copy interfaces to load data from DBs.</li>
<li><a href="https://github.com/kas-gui/kas/pull/57"><code>kas</code></a> - uses Generic Associated Types to avoid the unsafety around draw_handle and size_handle, fixing a possible memory-safety violation in the process.
<ul>
<li>&quot;generic associated types remove a usage of unsafe (revealing a bug in the process), and are almost certainly the way forward (once the compiler properly supports this)&quot;</li>
</ul>
</li>
<li><a href="https://github.com/tikv/raft-engine/pull/96"><code>raft-engine</code></a> - uses GATs in a generic builder pattern</li>
</ul>
<h3 id="blocked-at-least-in-part-by-gats"><a class="header" href="#blocked-at-least-in-part-by-gats">Blocked (at least in part) by GATs:</a></h3>
<ul>
<li>Rust in the linux kernel - https://github.com/Rust-for-Linux/linux/issues/2</li>
<li><a href="https://github.com/udoprog/audio/issues/3#issuecomment-1021805121"><code>udoprog/audio</code></a> - &quot;My goal is to author a set of traits and data structures that can be used across audio libraries in the ecosystem. I'm currently holding off on GATs landing, since that's needed to provide proper abstractions without incurring a runtime overhead.&quot;</li>
<li><a href="https://github.com/Emoun/graphene/issues/7"><code>graphene</code></a> - &quot;This would allow the result types of most Graph methods to be impl Iterator, such that implementors can use whatever implementation they want. To achieve this currently we are using <code>Box&lt;Iterator&gt;</code> as return types which is inefficient.&quot;</li>
<li><a href="https://github.com/amzn/ion-rust/issues/98"><code>ion-rust</code></a> - &quot;Currently, delegation via our current APIs are difficult because we cannot have an associated type that can be constructed with a per invocation lifetime. This example illustrates this, and shows how we can work around this by the judicious use of unsafe code[...]&quot;</li>
<li><a href="https://github.com/AltSysrq/proptest/issues/9"><code>proptest</code></a> - GATs could be used to represent non-owned values</li>
<li><a href="https://github.com/paritytech/ink/pull/1217#issuecomment-1124049962"><code>ink</code></a> - GATs could be used to simplify macro codegen around trait impl</li>
<li><a href="https://github.com/madsmtm/objc2/pull/37"><code>objc2</code></a> - Could use GATs to abstract over a generic <code>Reference</code> type, simplifying two methods into one</li>
<li><a href="https://github.com/Mange/mpris-rs/issues/64"><code>mpris-rs</code></a> - GATs could be used to abstract over an iterator type</li>
<li><a href="https://github.com/DioxusLabs/dioxus/pull/412#issue-1239019905"><code>dioxus</code></a> - &quot;It allows some property of a node to depend on both the state of it's children and it's parent. Specifically this would make text wrapping, and overflow possible&quot;</li>
<li><a href="https://github.com/pchampin/sophia_rs/issues/19#issuecomment-563972666"><code>sophia_rs</code></a> - An other way to go would be to have an &quot;rdf-api&quot; crate similar to what RDF/JS is doing for the RDF models and its commons extensions. And have Oxigraph and Sophia and hopefully the other RDF related libraries in Rust use it. But it might be hard to build a nice and efficient API without GAT.</li>
</ul>
<h3 id="other-miscellaneous-mentions-of-gats-or-gats-blocked-a-rewrite-but-workarounds-were-found"><a class="header" href="#other-miscellaneous-mentions-of-gats-or-gats-blocked-a-rewrite-but-workarounds-were-found">Other miscellaneous mentions of GATs, or GATs blocked a rewrite but workarounds were found</a></h3>
<ul>
<li><a href="https://github.com/veracruz-project/veracruz/pull/269"><code>veracruz</code></a> - The workaround here is to require the associated-type implementations to all be &quot;lifetime-less&quot;, which probably requires unsafe code in the implementations.</li>
<li><a href="https://github.com/rust-embedded-community/embedded-nal/issues/31#issuecomment-736676502"><code>embedded-nal</code></a> - Using a typestate pattern to represent UDP trait's states</li>
<li><a href="https://github.com/rust-ml/linfa/issues/119#issuecomment-884628664"><code>linfa</code></a> - For now though, there are several limitations to the implementation due to a lack of type-system features. For instance, it has to return a Vec of references to points because the lifetime to &amp;self has to show up somewhere in the return type, and we don't have access to GATs yet. Basically, I get around these issues by performing more allocation than we should [...]</li>
<li><a href="https://github.com/meilisearch/heed/pull/92"><code>heed</code></a> - Initial rewrite of a trait relied on GATs, was eventually worked around but has its own limitations?</li>
<li><code>ockam</code> - https://github.com/build-trust/ockam/issues/1564</li>
<li><a href="https://github.com/jonhoo/rust-imap/pull/208#discussion_r680427811"><code>rust-imap</code></a> - could benefit with a GATified <code>Index</code> trait</li>
<li><a href="https://github.com/lord/anchors/issues/4"><code>anchors</code></a> - &quot;GAT will let us skip cloning during map&quot;</li>
<li><a href="https://github.com/capnproto/capnproto-rust/pull/201#issuecomment-731585030"><code>capnproto-rust</code></a> - The main obstacle is that getting this to work (particularly with <code>capnp::traits::Owned</code>) probably requires generic associated types, and it's unclear when those will land on stable rust.</li>
<li><a href="https://github.com/metamolecular/gamma/issues/8"><code>gamma</code></a> - Could use GATs to return iterators instead of having to box them, possibly providing a more general API without the slowdown of boxing</li>
<li><a href="https://github.com/Enet4/dicom-rs/pull/152#discussion_r681182316"><code>dicom-rs</code></a> - GAT could be used to representing lifetime of borrowed data</li>
<li><a href="https://github.com/multiformats/rust-multihash/pull/116"><code>rust-multihash</code></a> - Apparently could use GATs to get around const-generics limitations </li>
<li><a href="https://github.com/divviup/libprio-rs/pull/202#discussion_r839932483"><code>libprio-rs</code></a> - Doing better will require a feature called &quot;generic associated types&quot; (per the SO above). Unfortunately, GATs are not stabilized yet; it looks like they are set to be stabilized in a few months.</li>
<li><a href="https://github.com/gluesql/gluesql/issues/483"><code>gluesql</code></a> - Could use GATs to turn a trait into an associated type<sup>(i think)</sup></li>
<li><a href="https://github.com/AndWass/pushgen/issues/44#issuecomment-890302372"><code>pushgen</code></a> - mentioned that things could be simplified by GATs (or RPITIT)</li>
<li><a href="https://github.com/olson-sean-k/plexus/issues/16#issuecomment-498786388"><code>plexus</code></a> - &quot;Until GATs land in stable Rust, this change requires boxing iterators to put them behind StorageProxy.&quot;</li>
<li><a href="https://github.com/tensorflow/rust/issues/162#issuecomment-587226628"><code>tensorflow/rust</code></a> - &quot;It would be most natural to provide an iterator over the records, but no efficient implementation is possible without GATS which I think I was hoping would already be in the language by now.&quot;</li>
</ul>
<h3 id="general-themes-for-why-folks-want-gats"><a class="header" href="#general-themes-for-why-folks-want-gats">General themes for why folks want GATs</a></h3>
<p>The general themes for why folks want GATs include...</p>
<ul>
<li>GATs to avoid boxing/cloning (achieving a more performant, zero-copy API)</li>
<li>GATs to represent lifetime relationships that can't be expressed using regular associated types (e.g. <code>fn(&amp;self) -&gt; Self::Gat&lt;'_&gt;</code>)
<ul>
<li>Some of these get around it by using unsafe code which could be removed with GATs</li>
</ul>
</li>
<li>GATs as a manual desugaring of RPITIT</li>
<li>GATs to offer a more abstract/pluggable API</li>
<li>GATs to provide a cleaner, DRY-er codebase</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="shiny_future/proposals.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="design_patterns/iterable.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="shiny_future/proposals.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="design_patterns/iterable.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
